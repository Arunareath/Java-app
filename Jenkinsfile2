pipeline {
    agent {
        kubernetes{
            yaml '''
                apiVersion: v1
                kind: Pod
                metadata:
                app: jenkins
                spec:
                containers:
                - name: maven
                    image: maven:alpine
                    command: ["sh", "-c", "echo 'Maven container started'; sleep 36000"]
                - name: docker 
                    image: docker
                    command: ["sh", "-c", "echo 'Docker container started'; sleep 36000"]
                volumeMounts:
                - mountPath: /var/lib/docker.sock
                    name: docker-path
                volumes:
                - name: docker-path
                    hostPath:
                    path: /var/lib/docker.sock
            '''
        } 
    }
    stages {
        stage('Clone') {
            steps {
                container('maven') {
                    checkout scm
                    sh 'mvn package'
                }
            }
        }
        stage('Login-Into-Docker') {
            steps {
                container('docker') {
                    sh 'docker login -u <docker_username> -p <docker_password>'
                }
            }
        }
        stage('Push-Images-Docker-to-DockerHub') {
            steps {
                container('docker') {
                    sh 'docker push ss69261/testing-image:latest'
                }
            }
        }
        }
        post {
            always {
                container('docker') {
                    sh 'docker logout'
            }
        }
    }
    
}
